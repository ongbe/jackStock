if(typeof Object.create!=="function"){Object.create=function(obj){function F(){}F.prototype=obj;return new F}}(function($,window,document,undefined){var NordnetSearchSuggest={init:function(options,elem){var self=this;self.elem=elem;self.$elem=$(elem);self.url="/search/suggest.html";self.latest="/search/latest.html";self.options=$.extend({},$.fn.nordnetSearchSuggest.options,options);self.$elem.autocomplete({minLength:0,open:function(){$(this).autocomplete("widget").css("z-index","");return false},source:function(request,response){self.source(request,response)},select:function(event,ui){self.select(event,ui)},focus:function(event,ui){self.focus(event,ui)}});self.$elem.data("autocomplete")._renderMenu=function(ul,items){self.renderMenu(ul,items)};self.$elem.data("autocomplete")._renderItem=function(ul,items){return self.renderItem(ul,items)}},search:function(){this.$elem.autocomplete("search")},fetch:function(query){var url=this.url;if(query===undefined||query.length<this.options.minLength){url=this.latest}return $.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:url,data:{q:query},dataType:"json"})},source:function(request,response){var self=this;self.fetch(request.term).done(function(results){self.seeAll=results.seeAll;self.newsName=results.newsName;var instrumentItems=$.map(results.instruments,function(item){return{label:item.name,value:item.name,source:item,type:"INSTRUMENT"}});if(results.news!==undefined){var newsItems=$.map(results.news,function(item){return{label:item.headline,value:item.headline,source:item,type:"NEWS"}});response(instrumentItems.concat(newsItems))}else{response(instrumentItems)}})},select:function(event,ui){var self=this,item=ui.item.source,menu=ui.item.menu,type=ui.item.type;if(item!==undefined&&item.url!==undefined){if(item.identifier!==undefined&&item.market_id!==undefined&&item.instrument_group_type!=="LATEST"){document.cookie="search_result=1;path=/;secure";document.cookie="search_result_name="+escape(item.name)+";path=/;secure";document.cookie="search_result_identifier="+escape(item.identifier)+";path=/;secure";document.cookie="search_result_marketid="+item.market_id+";path=/;secure";document.cookie="search_result_kind="+item.instrument_group_type+";path=/;secure"}window.location.href=item.url}else if(type!==undefined&&menu!=="LATEST"){if(menu!==undefined)submitSuggestForm(type,menu);else submitSuggestForm(type)}},focus:function(event,ui){event.preventDefault()},renderMenu:function(ul,items){var self=this,groupType="";$.each(items,function(index,item){var html="";if(item.type=="INSTRUMENT"){var itemGroupType=item.source.instrument_group_type,itemGroupTypeName=item.source.instrument_group_type_name,lastSearchResult=item.source.last_search_result;if(lastSearchResult){itemGroupType="LATEST";itemGroupTypeName=self.seeAll}if(lastSearchResult&&index===0||!lastSearchResult&&itemGroupType!=groupType){html='<li class="ui-autocomplete-category" '+"onclick=\"submitSuggestForm('instrument', '"+itemGroupType+'\'); return false;"><a class="menu">'+'<span class="pull-left">'+itemGroupTypeName+"</span>";if(itemGroupType!=="LATEST"){html+='<span class="seeAll pull-right">'+self.seeAll+"</span>"}html+='<br clear="both"></a></li>';var $menu=$(html).data("item.autocomplete",{type:"instrument",menu:itemGroupType});if(itemGroupType!=="LATEST"){$menu.addClass("ui-menu-item")}$menu.appendTo(ul);groupType=itemGroupType}}else if(item.type=="NEWS"){if(groupType!="NEWS"){html='<li class="ui-autocomplete-category" '+'onclick="submitSuggestForm(\'news\'); return false;"><a class="menu">'+'<span class="pull-left">'+self.newsName+"</span>"+'<span class="seeAll pull-right">'+self.seeAll+"</span>"+'<br clear="both"></a></li>';var $newsMenu=$(html).data("item.autocomplete",{type:"news"});$newsMenu.addClass("ui-menu-item");$newsMenu.appendTo(ul);groupType="NEWS"}}self.$elem.data("autocomplete")._renderItem(ul,item)})},renderItem:function(ul,item){var self=this;if(item.type=="INSTRUMENT"){var instrument=item.source,reg=new RegExp(self.$elem.val(),"gi"),instrumentName=instrument.instrument_group_type==="LATEST"?instrument.name:instrument.name.replace(reg,function(str){return"<b>"+str+"</b>"});return $("<li></li>").data("item.autocomplete",item).append('<a href="'+instrument.url+'" title="'+instrument.name+'">'+'<div class="suggest-price suggest-price-change '+getPriceChangeCssClass(instrument)+'">'+getPriceChange(instrument)+"</div>"+'<div class="suggest-price suggest-price-last">'+getLastPrice(instrument)+"</div>"+'<div class="suggest-name">'+getFlagImage(instrument)+instrumentName+"</div></a>").appendTo(ul)}else if(item.type=="NEWS"){var newsItem=item.source,newsReg=new RegExp(self.$elem.val(),"gi"),newsHeadline=newsItem.news_headline.replace(newsReg,function(str){return"<b>"+str+"</b>"});return $("<li></li>").data("item.autocomplete",item).append('<a href="'+newsItem.url+'" title="'+newsItem.news_headline+'">'+'<div class="suggest-price">'+newsItem.news_datetime+"</div>"+'<div class="suggest-name">'+getFlagImage(newsItem)+newsHeadline+"</div></a>").appendTo(ul)}}};$.fn.nordnetSearchSuggest=function(options){return this.each(function(){var nordnetSearchSuggest=Object.create(NordnetSearchSuggest);nordnetSearchSuggest.init(options,this);$.data(this,"nordnetSearchSuggest",nordnetSearchSuggest)})};$.fn.nordnetSearchSuggest.options={minLength:2,wrapEachWith:"<li></li>",limit:10,refresh:null,onComplete:null,transition:"fadeToggle"};function getFlagImage(item){var flag="";if(item.instrument_group_type!=="FND"&&item.market_country!==undefined){flag='<img src="/now/images/flagga'+capitaliseFirstLetter(item.market_country.toLowerCase())+'Small.gif">'}else if(item.news_lang_countrycode!==undefined){flag='<img src="/now/images/flagga'+capitaliseFirstLetter(item.news_lang_countrycode.toLowerCase())+'Small.gif">'}return flag}function getPriceChangeCssClass(instrument){if(instrument===undefined||instrument.priceChangeFormatted===undefined){return""}var change=parseFloat(instrument.priceChange);var css="";if(change<0){css="kursMinus"}else if(change>0){css="kursPlus"}return css}function getPriceChange(instrument){var priceChange="&nbsp;";if(instrument!==undefined&&instrument.priceChangeFormatted!==undefined){priceChange=instrument.priceChangeFormatted+"%"}return priceChange}function getLastPrice(instrument){var lastPrice="&nbsp;";if(instrument!==undefined&&instrument.lastPrice!==undefined){lastPrice=instrument.lastPrice+"&nbsp;"+instrument.currency}return lastPrice}function capitaliseFirstLetter(string){return string.charAt(0).toUpperCase()+string.substring(1)}})(jQuery,window,document);