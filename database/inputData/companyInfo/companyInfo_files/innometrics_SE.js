/* Gen: 1383300087 
Ver: 8 
Rev: 74ee2b7f32 
Copyright 2013 Innometrics 
http://innometrics.com */

function ElyArray(){ElyArray.prototype.push.apply(this,arguments)}var ElyTools=function(){function t(t,r){var e;for(e in r)t[e]=r[e];return t}function r(t,r){if("object"!=typeof t||null===t)return[];if(!r&&Object.keys)return Object.keys(t);var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(e);return n}function e(t){var r,e,n,o,i=document.cookie.split(";");for(e=0;e<i.length;e++)if(n=i[e],o=n.indexOf("="),r=n.substr(0,o).replace(/^\s+|\s+$/g,""),r==t)return decodeURIComponent(n.substr(o+1))}function n(t){return Array.isArray&&Array.isArray(t)||t instanceof Array}function o(t){return"undefined"==typeof t}function i(t){var r;if("object"!=typeof t)return!0;for(r in t)if(t.hasOwnProperty(r))return!1;return!0}function u(t){return this.isArray(t)&&0==t.length}function a(t){return"function"==typeof t}function c(t){return!isNaN(parseFloat(t))&&isFinite(t)}function f(t){return c(t)&&t==Math.floor(t)}function s(t){return"boolean"==typeof t}function l(t){return"string"==typeof t}function p(t){return"string"==typeof t||"function"==typeof t}function y(t){return"[object Object]"==Object.prototype.toString.call(t)}function h(t){return"string"==typeof t&&0!=t.length}function d(){var t=document.location;return t.origin||t.protocol+"//"+t.host}function g(t,r,e){if("undefined"==typeof t)return!1;if(t instanceof Array||t.length&&"undefined"!=typeof t[0])if(Array.prototype.forEach)Array.prototype.forEach.call(t,r,e);else{var n,o=t.length;for(n=0;o>n;n++)r.call(e,t[n],n,t)}else if(ElyTools.isUndefined(t.length)||"function"==typeof r){var i;for(i in t)t.hasOwnProperty(i)&&r.call(e,t[i],i,t)}return t}function m(t,r,e){var n=document.getElementsByTagName("head")[0]||document.documentElement,o=document.createElement("script"),i=!1;o.onload=o.onreadystatechange=function(){i||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(i=!0,o.onload=o.onreadystatechange=null,n&&o.parentNode&&n.removeChild(o),r&&r())},e&&e instanceof Function&&(o.onerror=e),o.type="text/javascript",o.src=t+(window._elyCacheBuster||""),window.XMLHttpRequest||(o.defer=!0),n.insertBefore(o,n.firstChild)}function v(t){return t.replace(/^./,function(t){return t.toLocaleUpperCase()})}function b(t){return t.replace(/_(\w)/g,function(t,r){return r.toUpperCase()})}function w(t){var r=t,e=[];for(r;r>=0;r--)e.push(97+Math.floor(26*Math.random()));return String.fromCharCode.apply(null,e)}function E(t){switch(t.type){case"checkbox":return t.checked;case"radio":return t.checked?t.value:null;case"select-one":return t.options[t.selectedIndex].text;case"select-multiple":return ElyArray.map(ElyArray.filter(t.options,"selected"),"text");default:return{input:1,select:1,textarea:1,button:1}[t.tagName.toLowerCase()]?t.value:null}}function A(t){var r,e,n,o=[],i=t.elements||[],u=i.length;for(r=0;u>r;r++){if(e=i[r],n=E(e),null==n)return;o.push({type:e.type,name:e.name,value:n})}return o}function O(t,r){return t&&0!=t.length?t.eq(0).attr(r):!1}function S(t,r){return t&&0!=t.length?(t=t.eq(0),r&&r.valueFrom?t.find(r.valueFrom).text():t.text()):!1}function j(t,r){if(!t||0==t.length)return!1;if(t=t.eq(0),!r||!r.custom)return t.val();switch(r.custom.type){case"attribute":if(r.custom.attribute&&r.custom.attribute.attrName&&r.custom.attribute.attrValue){var e=t.attr(r.custom.attribute.attrName),n=r.custom.attribute.attrValue,o=n.length;if(o>0)for(var i=0;o>i;i++)if(n[i]==e){var u=t.attr(r.custom.attribute.checkAttr);return r.custom.attribute.convert?!!u:u}}return t.val();case"text":return t.text();default:return t.val()}}return String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Object.copy=function(t,r){"undefined"==typeof r&&(r={});var e;for(e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return r},{extend:t,keys:r,isArray:n,isUndefined:o,isEmptyObject:i,isEmptyArray:u,isFunction:a,isInt:f,isString:l,isBool:s,isNumeric:c,isCode:p,isDataDimension:h,isValue:h,isObject:y,each:g,include:m,getCookieByName:e,ucfirst:v,toCamelCase:b,randomStr:w,serializeForm:A,serializeInput:E,getOrigin:d,getAttr:O,getTextValue:S,getNodeValue:j,$lambda:function(t){return t}}}();ElyTools.extend(Function.prototype,function(){function t(t,r){for(var e=t.length,n=r.length;n--;)t[e+n]=r[n];return t}function r(){var t=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!=t.length||t[0]?t:[]}function e(t){if(arguments.length<2&&ElyTools.isUndefined(t))return this;var r=this,e=o.call(arguments,1);return function(){return r.apply(t,e.concat(o.call(arguments)))}}function n(r){var e=this;return function(){var n=t([e.bind(this)],arguments);return r.apply(this,n)}}var o=Array.prototype.slice,i={argumentNames:r,wrap:n};return Function.prototype.bind||(i.bind=e),i}()),ElyArray.prototype=[],ElyArray.constructor=ElyArray,ElyArray.reduce=function(t,r,e){if("function"==typeof t.reduce)return t.reduce.apply(t,[].slice.call(arguments,1));if("function"!=typeof r)throw new TypeError('"'+r+'" is not a function');var n=t.length;if(!n){if(arguments.length>2)return e;throw new TypeError("reduce of empty array with no initial value")}var o=0,i=e;for(i=arguments.length<=2?t[o++]:e,o;n>o;o++)t.hasOwnProperty(o)&&(i=r(i,t[o],o,t));return i},ElyArray.reduceRight=function(t,r,e){if("function"==typeof t.reduceRight)return t.reduceRight.apply(t,[].slice.call(arguments,1));if("function"!=typeof r)throw new TypeError('"'+r+'" is not a function');var n=t.length;if(!n){if(arguments.length>2)return e;throw new TypeError("reduce of empty array with no initial value")}var o,i=n-1;for(o=arguments.length<=2?t[i--]:e,i;i>=0;i--)t.hasOwnProperty(i)&&(o=r(o,t[i],i,t));return o},ElyArray.filter=function(t,r,e){if("function"==typeof t.filter&&"function"==typeof r)return t.filter(r,e);var n;if("string"==typeof r&&(n=r,r=function(t){return t[n]}),"function"!=typeof r)throw new TypeError('"'+r+'" is not a function');var o,i=t.length,u=[];for(o=0;i>o;o++)Object.prototype.hasOwnProperty.call(t,o)&&r.call(e,t[o])&&u.push(t[o]);return u},ElyArray.map=function(t,r,e){if(null==t)throw new TypeError(" arr is null or not defined");if("function"==typeof t.map&&"function"==typeof r)return t.map(r,e);var n,o=Object(t),i=o.length>>>0;if("string"==typeof r&&(n=r,r=function(t){return t[n]}),"function"!=typeof r)throw new TypeError(r+" is not a function");for(var u=[],a=0;i>a;)o.hasOwnProperty(a)&&(u[a]=r.call(e,o[a],a,o)),a++;return u},ElyArray.findBy=function(t,r){var e,n=t.length-1;for(n;n>=0;n--){var o=t[n],i=!0;for(e in r)if(e in o){var u=r[e],a=o[e];i=i&&("function"==typeof u?u(a):a==u)}if(i)return t[n]}},ElyArray.inArray=function(t,r,e){for(var n=e||0,o=t.length;o>n;n++)if(t[n]===r)return n;return-1};var ElyClass=function(){function t(){}function r(){var r=null,e=[].slice.call(arguments);"function"==typeof e[0]&&(r=e.shift());var n=function(){return this.init.apply(this,arguments)};ElyTools.extend(n,ElyClass.Methods),n.superclass=r,n.subclasses=[],r&&(t.prototype=r.prototype,n.prototype=new t,r.subclasses.push(n));var o,i=e.length;for(o=0;i>o;o++)n.addMethods(e[o]);return n.prototype.init||(n.prototype.init=function(){}),n.prototype.constructor=n,n}function e(t){var r=this.superclass&&this.superclass.prototype,e=ElyTools.keys(t);n&&(t.toString!=Object.prototype.toString&&e.push("toString"),t.valueOf!=Object.prototype.valueOf&&e.push("valueOf"));var o,i=e.length;for(o=0;i>o;o++){var u=e[o],a=t[u];if(r&&"function"==typeof a&&"$super"==a.argumentNames()[0]){var c=a;a=function(t){return function(){return r[t].apply(this,arguments)}}(u).wrap(c),a.valueOf=c.valueOf.bind(c),a.toString=c.toString.bind(c)}this.prototype[u]=a}return this}var n=function(){var t;for(t in{toString:1})if("toString"===t)return!1;return!0}();return{create:r,Methods:{addMethods:e},getAllPrototypes:function(t){var r=[],e=t.constructor;for(e;e;e=e.superclass)r.push(e.prototype);return r}}}();var ElyCoreAware=ElyClass.create({core:null,raw:null,id:null,specialMergeProcessing:{},getProperty:function(e){var i,t=this;return ElyTools.each(this.getPropertyModel(),function(r){e==r.Codename&&(i=t[e])}),i},getCore:function(){return this.core},init:function(e,i){this.core=i,this.reconstruct(e)},validateField:function(e,i){var t,r=i.Codename,n=[],o=[],a=this;if("options"in i&&ElyTools.each(i.options,function(e){n.push(e.TheValue),o.push(e.Codename),e.IsDefault&&(t=e.Codename||e.TheValue)}),"array"==i.Type&&"undefined"==typeof t&&(t=[]),"value"!=i.Type||i.IsRequired){if(r in e){if(!a.isValidType(e[r],i.Type))return t?(e[r]=t,void 0):"invalid type ("+typeof e[r]+")";if("string"==i.Type&&""==e[r]&&i.IsRequired)return"invalid value: required non-empty string";if(n.length<=1)return;if(n.indexOf&&n.indexOf(e[r])>-1||ElyArray.inArray(n,e[r])>-1||ElyArray.inArray(o,e[r])>-1)return;return"invalid value (non-options)"}if(i.IsRequired)return"undefined"!=typeof t&&a.isValidType(t,i.Type)&&("string"!=i.Type&&"value"!=i.Type||""!==t)?(e[r]=t,void 0):"required"}},validate:function(e){return"live"===this.core.config.env?e.validFormat=!0:void 0},isValidType:function(e,i){var t=i,r={"int":"numeric","float":"numeric",text:"string"};i in r&&(i=r[i]);var n="is"+ElyTools.ucfirst(i),o=ElyTools[n];if("function"!=typeof o){var a='"'+i+'"';throw i!=t&&(a+=" ("+t+")"),new TypeError("typecheck function for type "+a+" is not defined")}return o.call(ElyTools,e)},serialize:function(){var e=this,i=ElyArray.reduce(this.getPropertyModel(),function(i,t){var r=t.Codename;return r in e?("array"==t.Type?e[r].length&&(i[r]=e[r]):t.options&&ElyArray.findBy(t.options,{IsDefault:!1}).TheValue===e[r]||(i[r]=e[r]),i):i},{});return this.getCore().toJSON(i)},mergeWith:function(e,i){if(!e)return this;var t=this.specialMergeProcessing;"undefined"==typeof i&&(i=!0);var r=this.getPropertyModel();return ElyTools.each(r,function(e){e.priority=+!!t[e.Codename]}),r.sort(function(e,i){return e.priority-i.priority}),ElyTools.each(r,function(r){this.getCore();var n,o=r.Codename;return"undefined"!=typeof e[o]?(n=e[o],"function"==typeof t[o]?t[o].call(this,n):"function"==typeof t["*"]?t["*"].call(this,o,n):"array"!=r.Type?this[o]=n:("object"!=typeof this[o]&&(this[o]=[]),i?(this[o]=this[o].concat(n),void 0):this[o]=n)):void 0},this),this}});function StringStream(t){this.string=t,this.idx=0,this.pos=0}function JSONParser(){}StringStream.prototype={eat:function(t){if(t instanceof RegExp){var r=this.string.slice(this.pos).match(t);if(r&&0===r.index)return this.lastMatch=r,this.pos+=r[0].length,!0}else if("string"==typeof t&&this.string.indexOf(t,this.pos)==this.pos)return this.lastMatch=t,this.pos+=t.length,!0},eatChar:function(){return this.string.charAt(this.pos++)},top:function(){return this.string.charAt(this.pos)},eos:function(){return this.string.length==this.pos},devour:function(){return this.string.substring(this.idx,this.idx=this.pos)},eatNwsChar:function(){return this.eat(/\s+/),this.eatChar()}},JSONParser.prototype={parseJSONString:function(t){for(var r=t.eatChar(),e="";r;){if("\\"==r){if(!t.eat(/(["\\\/bfnrt])|u([a-f\d]{4})/))throw new SyntaxError("bad escaped character "+t.top()+".");var s=t.lastMatch;e+=String.fromCharCode(parseInt(s[2],16)||{'"':34,"/":47,"\\":92,b:8,f:12,n:10,r:13,t:9}[s[1]])}else{if('"'==r)break;e+=r}r=t.eatChar()}return e},parseJSONError:function(t,r,e){throw new SyntaxError("Unexpected char `"+t+"` near `"+r.string.substr(r.pos-10,20)+"`. Expected '"+e+"'")},parseJSONArray:function(t){var r=[],e="[";if(t.eat(/\s+/),t.eat("]"))return r;for(;e&&(r.push(this.parseJSONNode(t)),e=t.eatNwsChar(),"]"!=e);)","!=e&&this.parseJSONError(e,t,","),t.eat(/\s+/);return r},parseJSONObject:function(t){for(var r,e=t.eatNwsChar(),s={};"}"!=e&&('"'!=e&&this.parseJSONError(e,t,'"'),r=this.parseJSONString(t),e=t.eatNwsChar(),":"!=e&&this.parseJSONError(e,t,":"),t.eat(/\s+/),s[r]=this.parseJSONNode(t),e=t.eatNwsChar(),"}"!=e);)","!=e&&this.parseJSONError(e,t,","),e=t.eatNwsChar();return s},parseJSONNode:function(t){if(t.eat(/null|true|false/))return{"true":!0,"false":!1,"null":null}[t.lastMatch[0]];if(t.eat(/-?(?:[1-9]\d*|0)(?:\.\d+)?(?:[eE][+\-]?\d+)?/))return parseFloat(t.lastMatch[0]);var r=t.eatChar();return"{"==r?this.parseJSONObject(t):"["==r?this.parseJSONArray(t):'"'==r?this.parseJSONString(t):(this.parseJSONError(r,t,"JSON value"),void 0)},parse:function(t){var r=t instanceof StringStream?t:new StringStream(String(t));if(!r.eat("{"))throw new SyntaxError("Unexpected token: "+(r.top()||r.devour())+" at char "+r.idx);return this.parseJSONObject(r)}};var ElyParser=ElyClass.create({master:null,_rawLogic:"",_parsedLogic:!1,_cache:{},_overrides:{},init:function(e){this.master=e,this._cache={},this._overrides={}},getRawLogic:function(){return this._rawLogic},parseParenthesis:function(e,r,t,i,s){var a,n=0,h=0,c=0,o="",g=[],d=e.length;for(a=0;d>a&&!(s&&g.length>=s);a++)e.charAt(a)==r?(0==n&&(o+=e.substring(c,a),h=a),n++):e.charAt(a)==t&&(n--,0==n&&(g.push(e.substring(h,a+1)),o+=i(g),c=a+1));return o+=e.substring(c,e.length),{matched:g,stripped:o}},_p:function(e,r,t){var i=this.pp(e,r,t);return i&&i.isValid(this.master.subOverride)},pp:function(type,id,overrideIndex,noOverrides){var cacheId=type+":"+id.toString()+":"+overrideIndex;if(this.getCache(cacheId))return this.getCache(cacheId);var merge={};if(""!=overrideIndex)try{eval("merge = "+this.master.getTopLevel().parser._overrides[overrideIndex])}catch(e){var instance=this.master;return instance instanceof ElyBRuleGroup&&(instance=instance.owner),this.getCore().fireEvent("RuleParsingMergeError",{error:e,instance:instance},["exception"]),!1}var iCloned;if("~"==type)iCloned=this.master.splGroups[id].mergeWith(this.master.subOverride);else{var iSrc=this.getCore().getRuleById(id);if(!iSrc){var instance=this.master;return instance instanceof ElyBRuleGroup&&(instance=instance.owner),this.getCore().fireEvent("RuleNotFound",{instance:instance},["exception"]),!1}iCloned=this.getCore().jQ.extend(!0,{},iSrc,this.master.subOverride&&!noOverrides?this.master.subOverride:{})}var iMerged=""!=overrideIndex?iCloned.mergeWith(eval(merge)):iCloned;return this.setCache(cacheId,iMerged),iMerged},_parseLogic:function(e){if(this.clearCache(),this._parsedLogic=!0,this._rawLogic.match(/^\s*$/))return this;var r="";if(e||this._rawLogic.match(/[{}]/)){var t;if(this.master.owner)t=this._rawLogic;else{var i=this.parseParenthesis(this._rawLogic,"{","}",function(e){return"{"+(e.length-1)+"}"});this.master.getTopLevel().parser._overrides=i.matched,t=i.stripped}var s=this.parseParenthesis(t,"(",")",function(e){return"~"+(e.length-1)});ElyTools.each(s.matched,function(e,r){this.master.splGroups[r]=new ElyBRuleGroup(e+'{"id": '+r+"}",this.master)},this),r=s.stripped}else r=this._rawLogic;for(var a,n,h=new RegExp(/([=~])(\d+)(\{(\d+)\})*/g),c=h.exec(r);c;)a=this.master.getTopLevel(),"="==c[1]&&(n=this.getCore().getRuleById(c[2]))&&(a.addSupplementary(n),n.addSubscriber(a)),c=h.exec(r);return this._parsedLogic=r.replace(h,"this._p('$1', $2, '$4')"),this},parseRelations:function(){return this._parsedLogic||this._parseLogic(),this},getCache:function(e){return this.master.getTopLevel().parser._cache[e]},setCache:function(e,r){this.master.getTopLevel().parser._cache[e]=r},clearCache:function(){this.master.getTopLevel().parser._cache={}},reconstructMaster:function(e){var r=e||this.master.raw;this.master.raw=r,this.master.validFormat=!1;var t=this.parseParenthesis(r,"(",")",function(){return""},1);if(""==t.stripped||!t.matched[0])return this.master;var i=this.getCore().fromJSON(t.stripped);return i||this.getCore().fireEvent("InvalidJSON",{error:"json err",string:t.stripped,instance:this.getCore()},["exception"]),this._rawLogic=t.matched[0].substring(1,t.matched[0].length-1),this.getCore().fireEvent("parserAware.logicAreaSet",{instance:this.master},["globalLog"]),i&&this.master.mergeWith(i)?!this.master.id&&0!==this.master.id||isNaN(this.master.id)||parseInt(this.master.id)!=this.master.id?this.master:(this.getCore().fireEvent("parserAware.merged",{instance:this.master,merged_with:i},["globalLog"]),this.master.validFormat=!0,this.master):this.master},getCore:function(){return this.master.getTopLevel().core},validateLogic:function(){this._parsedLogic||this._parseLogic();var ret=!0;try{ret=eval(this._parsedLogic)}catch(e){this.getCore().fireEvent("RuleParsingError",{error:e,instance:this.master},["exception"]),ret=!1}return ret},getInstanceName:function(){return"ElyParser"}});var ElyParserAware=ElyClass.create(ElyCoreAware,{parser:null,splRules:{},splGroups:{},init:function($super,e,r){this.parser=new ElyParser(this),$super(e,r),this.splRules={},this.splGroups={}},getCore:function(){return this.getTopLevel().core},serialize:function($super){return"("+this.parser.getRawLogic()+")"+$super()},getPropertyModel:function(){return this.getCore().config.propertyModel.rule}});var ElyAdapter=ElyClass.create({core:null,config:{},mappings:[],init:function(n,t){this.config=n,this.mappings=[],this.core=t},registerMapping:function(n){return this.mappings.push(n),this},getMappings:function(n){return ElyArray.filter(this.mappings,function(t){return n.id==t.rule})},getCodename:function(){return this.config.codename},trackerInit:function(){},trackerReady:function(){},trackerLoad:function(){},trackerPostLoad:function(){},trackerApply:function(){}});var ElyBRule=ElyClass.create(ElyParserAware,{codename:null,persistent:!1,saveToHistory:!1,validFormat:!1,conditions:[],triggers:[],dataDimensions:[],failed:!1,_exclusiveCondition:!1,_supplementaries:{},_subscribers:{},_pvs:null,specialMergeProcessing:{triggers:function(i){ElyTools.each(i,function(i){this.pushTrigger(i)},this)},expire:function(i){this.expire=i}},addSupplementary:function(i){this._supplementaries[i.id]=i},addSubscriber:function(i){this._subscribers[i.id]=i},getDataDimension:function(i){var t=!1;return ElyTools.each(this.dataDimensions,function(e){t||e.codename!=i||(t=e)}),t},getDataDimensionVal:function(i,t,e){var s=!1,n=this.dataDimensions;return ElyTools.each(n,function(r,o){s||r.codename!=i||(!t&&this.persistent&&r.value||(n[o].value=this.core.getClosure("data_dimension:"+r.logic).execute(this,r.args,e)),s=n[o].value)},this),s},resetDataDimensionVal:function(){ElyTools.each(this.dataDimensions,function(i,t){this.dataDimensions[t].value=""},this)},createDataDimension:function(i,t){var e;for(e=0;e<this.dataDimensions.length;e++)this.dataDimensions[e].codename==i&&this.dataDimensions.splice(e,1);this.dataDimensions.push({codename:i,value:t,logic:"Core/Static",args:{val:t}})},sessionLimitCheck:function(){return this.core.getHistory().sessionLimitCheck(this.id)},getSubscribers:function(){var i=[];return this.parser.parseRelations(),ElyTools.each(this._subscribers,function(t){i.push(t)}),i},isExpired:function(){if(!this.expire)return!1;var i=(new Date).getTime()/1e3;return this.expire[0]&&this.expire[0]>i?!0:this.expire[1]&&this.expire[1]<i?!0:!1},isValid:function(i){return this.isExpired()?!1:!i&&this.persistent&&null!==this._pvs?this._pvs:(this._pvs=this.validateConditions()&&this.validateLogic(),this._pvs)},doValidateConditions:function(i){i=i||{};var t="function"==typeof i.filter?ElyArray.filter(this.conditions,i.filter,this):this.conditions;"function"==typeof i.sorter&&t.sort(i.sorter);var e=!0;return ElyTools.each(t,function(i){var t=this.core.getClosure("condition:"+i.logic);!e||this._exclusiveCondition&&!t.exclusive||t.execute(this,i.args)||(e=!1)},this),e},validateConditions:function(){function i(i){return t.core.getClosure("condition:"+i.logic).getCost(t,i.args)}var t=this,e=function(i){var t=this.core.getClosure("condition:"+i.logic);return t?(t.exclusive&&(this._exclusiveCondition=!0),!0):void 0},s=function(t,e){return i(t)-i(e)};return this.doValidateConditions({filter:e,sorter:s})},validateStaticConditions:function(){var i=function(i){var t=this.core.getClosure("condition:"+i.logic);return t&&0===t.getCost(this,i.args,0)?(t.exclusive&&(this._exclusiveCondition=!0),!0):void 0};return this.doValidateConditions({filter:i})},populateDataDimensions:function(i,t){return ElyTools.each(this.dataDimensions,function(e){(t||!e.lazy)&&this.getDataDimensionVal(e.codename,i,"populateDataDimensions")},this),this},validateLogic:function(){return this.parser.validateLogic()},setTrigger:function(i){if(this.core.config.track){var t=this.core.getClosure("trigger:"+i.logic);t&&t.execute(this,i.args)}return this},pushTrigger:function(i){return this.triggers.push(i),this},trigger:function(i){return i||this.isValid()?(this.core.fireEvent("RuleTriggered",{instance:this},["globalLog"]),this.resetDataDimensionVal(),this.populateDataDimensions(),this.saveToHistory&&this.sessionLimitCheck()&&this.core.getHistory().set(this),this.core.trackerApplyAdapters(this),this.core.trackerApplyTags(this),this):this},getTopLevel:function(){return this},reconstruct:function(i){this._exclusiveCondition=!1,this.splGroups={},this._supplementaries={},this._subscribers={},this.conditions=[],this.dataDimensions=[],this.triggers=[];var t=this.parser.reconstructMaster(i);return this.validate(t,i),this},getPropertyModel:function(){return this.core.config.propertyModel.rule}});var ElyBRuleGroup=ElyClass.create(ElyParserAware,{owner:null,subOverride:{},getProperty:function(e){var r,t=this;return"id"==e?this.id:(ElyTools.each(this.getPropertyModel(),function(i){e==i.Codename&&(r=t.subOverride[e])}),r)},specialMergeProcessing:{id:function(e){this.id=e},"*":function(e,r){this.subOverride[e]=r}},init:function($super,e,r,t){return this.owner=r,this.subOverride={},$super(e,t)},getTopLevel:function(){return this.owner.getTopLevel()},isValid:function(){return this.getTopLevel().core.fireEvent("parserAware.validationRequested",{instance:this}),this.parser.validateLogic()},reconstruct:function(e){return this.splGroups={},this.parser.reconstructMaster(e)}});var ElyIClosure=ElyClass.create(ElyCoreAware,{closure:null,sclosure:null,taxonomy:null,packagename:null,codename:null,validFormat:!1,cost:2,triggeredBy:null,exclusive:!1,runOnce:!0,getUniqueName:function(){return this.taxonomy+":"+this.packagename+"/"+this.codename},execute:function(e,t,r){if(!this.doesAcceptArgs(t))return!1;var s=!1;if(!this.closure)try{this.closure=new Function("rule","args","state",this.sclosure)}catch(i){return this.closure=!1,!1}try{s=this.closure.apply(this,[e,t,r])}catch(i){}return s},doesAcceptArgs:function(e){var t=this,r=!0;return ElyTools.each(this.getArgumentModel(),function(s){t.validateField(e,s)&&(r=!1)}),r},getCost:function(e,t,r){var s="undefined"!=typeof r?Number(r)||0:this.cost;return t&&t.dd&&e.getDataDimension(t.dd)&&(s+=this.core.getClosure("data_dimension:"+e.getDataDimension(t.dd).logic).getCost(e)),s},reconstruct:function(e){var t=e||this.raw;this.raw=t,this.validFormat=!1;var r;if("string"!=typeof t)r=t,this.closure=r.sclosure;else{try{r=JSONParser.prototype.parse(t)}catch(s){r=!1}if(!r)return this}return this.mergeWith(r),this.validate(this),this},mergeWith:function($super,e){var t=[];if(this.codename&&(t=[this.getUniqueName(),this.getUniqueName.call(e)]),$super(e),t[0]!=t[1]){var r=this.getCore();r.renameClosure.apply(r,t)}return this},serialize:function($super){var e=this.core.fromJSON($super());return e.sclosure||"function"!=typeof this.sclosure||(e.sclosure=this.sclosure.toString().replace(/^.*\n/,"").replace(/\n\}$/,"")),this.core.toJSON(e)},getPropertyModel:function(){return this.core.config.propertyModel.closure},getArgumentModel:function(){return this.argModel||[]}});var ElyCore=ElyClass.create({config:{},adapters:[],rules:{},ruleOrder:[],_pageLoads:[],closures:{},tags:{},jQ:null,history:{},_eventPool:[],_listeners:{},_apiPool:[],_readyState:!1,_trackerStates:{},_jqState:!1,includes:{},_canSaveCookie:!0,timeInit:null,init:function(t){ElyTools.each(["Include","Adapter","Tag","Closure","AdapterMapping","TagMapping"],function(t){this["onSet"+t+"s"]=function(e){ElyTools.each(e,function(e){this["register"+t](e)},this)}},this),ElyTools.each(["Rule"],function(t){this["onSet"+t+"s"]=function(e){ElyTools.each(e,function(e){this.push({method:"register"+t,args:[e]})},this)}},this),"object"==typeof JSON&&"function"==typeof JSON.stringify&&(this.toJSON='"[]"'===JSON.stringify([])?Object.toJSON:JSON.stringify),this.timeInit=new Date,this.includes={},this.adapters=[],this.tags={},this.rules={},this.ruleOrder=[],this.closures={},this._trackerStates={},this.history={};var e=ElyTools.getCookieByName("swdc_env");return e&&e!=t.env&&t.switchSrc?(ElyTools.include(t.switchSrc[location.protocol.replace(/:$/,"")]),this):(this.setConfig(t),this.jQ=null,window.ely&&window.ely instanceof Array&&(this._apiPool=this._apiPool.concat(window.ely)),this.config.track?this._trackerInit():this._coldStart(),void 0)},addPageLoad:function(t){this._pageLoads.push(t)},_getTopDomain:function(){function t(t,e){return"."+t.slice(-e).join(".")}var e=document.domain.match(/[\d]{1,3}\.[\d]{1,3}\.[\d]{1,3}\.[\d]{1,3}/)||document.domain.split(".");if(1==e.length)return"";var i=parseInt(this.config.history.cookie.domainPeriods,10)||2,r=t(e,i);if(2==i){var o={".co.uk":!0};o[String(r).toLowerCase()]&&(r=t(e,i+1))}return r},_processTrackerCallbacks:function(t){var e="tracker"+t;this._trackerStates[e]?ElyTools.each(this._trackerStates[e],function(t){t.callback(t.target)}):this._trackerStates[e]=[],this._trackerStates[e].pass=!0},push:function(){var t=this._apiPool;return t.push.apply(t,arguments),this._readyState&&ElyTools.each(arguments,this.processApiCall,this),t.length},failApiCall:function(t,e){return this.fireEvent("ApiCallFail",{instance:t,target:t,requested:e},["globalLog","exception"])},processApiCall:function(t,e){"number"==typeof e&&(e=null);var i=e||this;if("ruleMap"==t.method&&!e){if(!t.args.rule)return this.failApiCall(i,t);var r=this.rules[t.args.rule];if(!r)return;return this.processApiCall(t.args,r)}if(t.method.match(/^tracker/)){if(this._trackerStates[t.method]){if(this._trackerStates[t.method].pass)return t.callback(i)}else this._trackerStates[t.method]=[];t.target=i,this._trackerStates[t.method].push(t)}else if(i[t.method]){var o=i[t.method].apply(i,t.args);return t.callback&&t.callback(i,o),o}return"includePicker"==t.method&&(this.name="InEasyliticsHelper",this.include("picker")),this.failApiCall(i,t)},_adapterInit:function(){if(this.config.adapters){var t;for(t in this.config.adapters)this.config.adapters.hasOwnProperty(t)&&this.registerAdapter(t)}},hasFeature:function(t){switch(t){case"cookie-compliance":return!!this.getAdapters("CookieCompliance")[0];default:return!1}},_coldStart:function(){this._adapterInit(),this.include("jquery")},_trackerInit:function(){this._processTrackerCallbacks("Init"),this._adapterInit(),this.adapterMap("trackerInit"),this.include("jquery")},_trackerReady:function(){"dev"==this.config.env&&this.jQ(document).bind("ely.exception",this.trackExceptions);var t=this;return this.canSaveCookie(),this._processTrackerCallbacks("Ready"),this._readyState=!0,this.adapterMap("trackerReady"),ElyTools.each(this._apiPool,this.processApiCall,this),ElyTools.each(this.ruleOrder,function(e){var i=t.rules[e];i.validateStaticConditions()&&ElyTools.each(i.triggers,i.setTrigger,i)}),this.getHistory(),this.adapterMap("trackerLoad"),this.jQ(function(){ElyTools.each(t._pageLoads,function(t){t.triggeredBy="load",t.trigger()}),t._trackerPostLoad()}),this},_trackerPostLoad:function(){this.adapterMap("trackerPostLoad"),this._processTrackerCallbacks("PostLoad")},trackerApplyAdapters:function(t){this.adapterMap("trackerApply",[t]),this._processTrackerCallbacks("Apply")},trackerApplyTags:function(t){this.tagMap("trackerApply",[t]),this._processTrackerCallbacks("Apply")},registerRule:function(t){var e=new ElyBRule(t,this);return e.validFormat?(this.rules[e.id]=e,this.ruleOrder.push(e.id),e):void 0},registerClosure:function(t){var e=new ElyIClosure(t,this);return e.validFormat?(this.closures[e.getUniqueName()]=e,e):void 0},registerAdapter:function(t){var e=t.codename+"Adapter";if(window[e]){var i=new window[e](t,this);return this.adapters.push(i),i}return!1},registerAdapterMapping:function(t){this.adapterMap("registerMapping",[t],t.adapter)},registerTag:function(t){var e=new ElyTag(t,this);return e.validFormat?(this.tags[e.getUniqueName()]=e,e):void 0},registerTagMapping:function(t){this.tagMap("registerMapping",[t],t.tag)},registerInclude:function(t){return t.url?(this.includes[t.codename]=t,t.codename):!1},include:function(t,e){var i=this.includes[t];if(!i)return!1;var r,o=ElyTools.extend(i,e||{});if(o.complete&&(r=o.complete,"function"!=typeof r&&(r=new Function("core",r))),o.check){var n=o.check;if("function"!=typeof n&&(n=new Function("core",n)),!n.call(o,this)){var s=this;return setTimeout(function(){s.fireEvent("IncludeCheckFailed",{name:t},["globalLog"])},100),r&&r.call(o,this),!1}}var a,c=this;if(o.forceHttp||"https:"!=location.protocol)a=o.url;else{if(!o.surl)return this.include(t,ElyTools.extend(o,{surl:o.url.replace(/^https/,"http"),error:function(){c.include(name,ElyTools.extend(o,{forceHttp:!0}))}}));a=o.surl}return ElyTools.include(a,function(){r.call(o,c),c.fireEvent("IncludeLoaded",{name:t},["globalLog"])},o.error),!0},getRuleById:function(t){return this.rules[t]},getClosure:function(t){return this.closures[t]},setConfig:function(t){var e=this.config={};ElyTools.each(t,function(t,i){e[i]=t}),this.registerClosure({taxonomy:"data_dimension",packagename:"Core",codename:"Static",sclosure:function(t,e){return e.val},id:99999}),e.onSet&&ElyTools.each(e.onSet,function(t,e){this["onSet"+ElyTools.ucfirst(e)](t)},this),this.config.topDomain=this.config.topDomain||this._getTopDomain()},getHistory:function(t){return this._retrieveHistory(t)},getAdapters:function(t){return t?ElyArray.filter(this.adapters,function(e){return e.getCodename()==t}):this.adapters},getTags:function(t){if(!t){var e=[];return ElyTools.each(this.tags,function(t){e.push(t)}),e}return this.tags[t]?[this.tags[t]]:[]},adapterMap:function(t,e,i){ElyTools.each(this.getAdapters(i),function(i){var r=i[t];if(i&&"function"==typeof r)try{r.apply(i,ElyTools.isArray(e)?e:[])}catch(o){}},this)},tagMap:function(t,e,i){ElyTools.each(this.getTags(i),function(i){var r=i[t];if(i&&"function"==typeof r)try{r.apply(i,ElyTools.isArray(e)?e:[])}catch(o){}},this)},pluginMap:function(t,e,i){var r=[].concat(this.getAdapters(i),this.getTags(i));ElyTools.each(r,function(i){var r=i[t];if(i&&"function"==typeof r)try{r.apply(i,ElyTools.isArray(e)?e:[])}catch(o){}},this)},checkBindings:function(t){var e=!1;return ElyTools.each(this.adapters,function(i){!e&&i.getMappings(t).length>0&&(e=!0)}),e},fireEvent:function(t,e){return ElyTools.each(this._listeners[t]||[],function(t){t(e)}),!1},registerEvent:function(t,e){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)},_retrieveHistory:function(t){if("memory"!=t&&!this._canSaveCookie)return this.getHistory("memory");t||(t=window.ElyLocalStorageHistory.prototype.isAvailable()&&!this.config.ignoreLocalStorage?"local":window.ElyCookieHistory.prototype.isAvailable()?"cookie":"memory");var e={local:window.ElyLocalStorageHistory,cookie:window.ElyCookieHistory,memory:window.ElyMemoryHistory}[t];if(!e)throw new TypeError("Unknown history type "+t);return this.history[t]||(this.history[t]=new e(this)),this.history[t]},quoteString:function(t){return'"'+t.replace(/["\\\x00-\x1f\x7f-\x9f]/g,function(t){var e=t.charCodeAt();return"\\"+({8:"b",9:"t",10:"n",12:"f",13:"r",34:'"',92:"\\"}[e]||"u"+("000"+e.toString(16)).slice(-4))})+'"'},toJSON:function(t,e){if(!e&&"object"==typeof JSON&&JSON.stringify)return JSON.stringify(t);var i=typeof t;if(null===t)return"null";if("undefined"==i)return void 0;if("number"==i||"boolean"==i)return t+String();if("string"==i)return this.quoteString(t);if("object"===i){if(t.constructor===Date){var r=t.getUTCMonth()+1;10>r&&(r="0"+r);var o=t.getUTCDate();10>o&&(o="0"+o);var n=t.getUTCFullYear(),s=t.getUTCHours();10>s&&(s="0"+s);var a=t.getUTCMinutes();10>a&&(a="0"+a);var c=t.getUTCSeconds();10>c&&(c="0"+c);var l=t.getUTCMilliseconds();return 100>l&&(l="0"+l),10>l&&(l="0"+l),'"'+n+"-"+r+"-"+o+"T"+s+":"+a+":"+c+"."+l+'Z"'}if(t.constructor===Array){var u,h=[];for(u=0;u<t.length;u++)h.push(this.toJSON(t[u],e)||"null");return"["+h.join(",")+"]"}var f,p=[];for(f in t)if(t.hasOwnProperty(f)){if("function"==typeof t[f])continue;var d=this.quoteString(f),y=this.toJSON(t[f],e);p.push(d+":"+y)}return"{"+p.join(",")+"}"}},fromJSON:function(t){return this.jQ.secureEvalJSON(t)},toSimpleArray:function(t){return ElyTools.isArray(t)?(ElyTools.each(t,function(e,i){"object"==typeof e&&(t[i]=this.toJSON(e))},this),t):t},cookie:function(t,e,i){var r;if(null===e||"object"!=typeof e&&"undefined"!=typeof e){if(i=i||{},null!==e&&!this._canSaveCookie&&!i.ignorecc)return!1;if(null===e&&(i.expires=-1),"number"==typeof i.expires){var o=i.expires,n=i.expires=new Date;n.setTime(n.getTime()+864e5*o)}else i.expires instanceof Date||(i.expires=null);r=String(e);var s=[t+"="+(i.raw?r:encodeURIComponent(r))];return i.expires&&s.push("expires="+i.expires.toUTCString()),i.path&&s.push("path="+i.path),s.push("domain="+this.config.topDomain),i.secure&&s.push("secure"),document.cookie=s.join("; ")}i=e||{};var a=new RegExp("(?:^|; )"+encodeURIComponent(t)+"=([^;]*)");return r=a.exec(document.cookie),r?i.raw?r[1]:decodeURIComponent(r[1]):null},canSaveCookie:function(){return this.compliantData(this.config.cookieCompliancePolicy||"none",this.config.cookieComplianceCategory||"analytics",!0)},compliantData:function(t,e,i){var r=!0;if(i=i||!1,t&&"none"!=t){var o=this.fromJSON(this.cookie("ElyCCObject")||"{}"),n=o[e]||o.elydefault||[],s=+n[0];r=isNaN(s)?"opt-out"==t:s}return this._canSaveCookie&&!r&&this.getHistory().clearStorage(),i&&(this._canSaveCookie=r),r},deleteAllCookies:function(){this.getHistory().clearStorage(),ElyTools.each(["ElyCCObject",this.config.cookieId||"Ely_vID","elytis","elytil","swdc_env"],function(t){this.cookie(t,null,{path:"/"})},this)},_jquerySafeEvent:function(t,e,i,r,o){if(!this.jQ)return!1;var n=this.jQ(e);if(!n||0==n.length)return!1;if(this.jQ.fn.on)o?n.on(t,i,r):n.find(i).on(t,r);else{if(!this.jQ.fn.live||!this.jQ.fn.bind)return!1;o?n.find(i).live(t,r):n.find(i).bind(t,r)}},jquerySafeEvent:function(t,e,i,r,o){switch(arguments.length){case 3:this._jquerySafeEvent(t,document,e,i,!1);break;case 4:this._jquerySafeEvent(t,e,i,r,!1);break;case 5:this._jquerySafeEvent(t,e,i,r,o);break;default:return!1}},setStyleProperty:function(t,e,i,r){t=t.style?t:t instanceof Object&&t[0]&&t[0].style?t[0]:!1;var o=e+":"+i+(r?" !important":"")+";";if(!t)return!1;var n=t.style.cssText;n||(t.style.cssText=o);var s,a,c,l="",u=!1;for(n=n?n.split(";"):!1,s=0,a=n.length;a>s;s++)if(c=n[s].split(":"),!(c.length<=1)){if(c[0]=c[0].replace(/\s+/g,""),c[0]==e){if(!i)continue;c[1]=i+(r?" !important":""),u=!0}l+=c[0]+":"+c[1]+";"}u||(l+=o),t.style.cssText=l}});var ElyHistory=ElyClass.create({codeName:null,core:null,lastSavedSession:null,currentSession:null,visitorId:null,savedRules:{},sessions:{},rulesPerSession:{},vars:{},fullVars:{},init:function(t){this.core=t,this.currentSession=null,this.lastSavedSession=null,this.visitorId=this.getVisitorId(),this.savedRules={},this.sessions={},this.vars={},this.fullVars={},this.load(),this.addSession(this.getCurrentSession()),this.set(!1)},clear:function(t){this.sessions={},t||(this.vars={}),this.addSession(this.getCurrentSession()),this.savedRules={}},load:function(){var t,s=[],i=this.getConfigOption("storageVolumeLimit");for(t=0;i>t;t++){var e="ElyHistory"+t;s.push(this._getVolume(e))}this.deserialize(s.join(""))&&ElyTools.each(this.sessions,function(t,s){this.sessions[s]||(this.sessions[s]=[]),this.rulesPerSession[s]||(this.rulesPerSession[s]={}),ElyTools.each(t,function(t){var i=t.split(","),e=this.core.getRuleById(i[0]);this.add(e||i[0],s,i[1])},this)},this)},write:function(){var t=this.serialize(),s="ElyHistory0";return this._setVolume(s,t),this.core.fireEvent("history."+this.getCodename()+"Write",{cookie:s,content:t},["globalLog"]),this},serialize:function(){var t=[];ElyTools.each(this.sessions,function(s,i){t.push(i+"="+s.join(":"))});var s=encodeURIComponent(this.core.toJSON(this.vars));return t.unshift(s),t.join("|")},deserialize:function(t){this.validFormat=!1,this.clear();var s=t.match(/^(\%7B.*\%7D)(.*)$/);if(!s)return!1;var i=s[1],e=s[2].split("|");e[0]||e.shift();try{var n=decodeURIComponent(i),r=this.core.fromJSON(n);if(r===!1)throw this.vars={},this.fullVars={},new Error("Error parsing JSON, source is not valid.");this.vars=r,this.fullVars=this.core.fromJSON(n)}catch(o){return this.core.fireEvent("InvalidJSON",{error:o,string:i,instance:this},["exception"]),!1}return ElyTools.each(e,function(t){var s=t.split("=");if(!(s.length<2)){var i=this.addSession(s[0]);s[1]&&ElyTools.each(s[1].split(":"),function(t){t.match(/^\d+,\d+$/)&&i.push(t)})}},this),this.validFormat=!0},setVar:function(t,s){var i=encodeURIComponent(this.core.toJSON(s));return i.toString().length>this._getSizeLimit()?!1:(this.vars[t]=this.fullVars[t]=s,this._varLimitCheck(),this._sizeLimitCheck(),!0)},pushVar:function(t,s){var i=encodeURIComponent(this.core.toJSON(s));return i.length>this._getSizeLimit()?!1:(ElyTools.isArray(this.fullVars[t])||(this.fullVars[t]=[]),ElyTools.isArray(this.vars[t])||(this.vars[t]=[]),this.fullVars[t].push(s),this.vars[t].push(s),this._varLimitCheck(),this._sizeLimitCheck(),!0)},getVar:function(t){var s=this.fullVars[t];return ElyTools.isArray(s)?s.slice():s},_shiftVar:function(){var t=null;ElyTools.each(this.vars,function(s,i){return t?void 0:(t=i,!1)}),this.vars[t]instanceof Array&&1!=this.vars[t].length?this.vars[t].shift():delete this.vars[t]},_getVarCount:function(){var t=0;return ElyTools.each(this.vars,function(){t++}),t},_varLimitCheck:function(){for(var t=this._getVarCount()-this.getConfigOption("storageVarLimit");t>0;)t--,this._shiftVar()},_sizeLimitCheck:function(){var t=this._calcStorageLenDiff();if(t>0)for(var s=0;t>0;){var i=this.shiftRule(!0);i||this.shiftSession(),t=this._calcStorageLenDiff(),s==t&&t>0&&this._shiftVar(),s=t}this.write()},sessionLimitCheck:function(t){var s=this.sessions[this.getCurrentSession()]||[],i=s.join(":"),e=new RegExp("(^|:)"+t+",","g"),n=i.match(e),r=n?n.length:0,o=this.core.config.history.sessionLimit;return!o||o>r},get:function(t){return this.savedRules[t.id]||[]},set:function(t){var s=this.getNowTimestamp()-parseInt(this.getCurrentSession());0>s||(this.addSession(this.getCurrentSession()),this.lastSavedSession=this.getCurrentSession(),t&&this.add(t.id,this.getCurrentSession(),s,!0),this.lastSavedSession=this.getCurrentSession(),this._sizeLimitCheck())},add:function(t,s,i,e){var n=t.id||t;this.savedRules[n]||(this.savedRules[n]=[]),this.savedRules[n].push({session:s.toString(),time:i.toString()}),e&&this.sessions[s].push(n+","+i),this.rulesPerSession[s]||(this.rulesPerSession[s]={}),this.rulesPerSession[s][n]?this.rulesPerSession[s][n]++:this.rulesPerSession[s][n]=1},addRule:function(t,s,i,e){this.addSession(s)[e?"unshift":"push"](t+","+i)},popRule:function(){var t=null;if(ElyTools.each(this.sessions,function(s,i){s.length>0&&(t=i)}),!t)return!1;var s=this.sessions[t].pop();if(!s)return!1;var i=s.split(",");return{session:t,rule:i[0],time:i[1]}},shiftRule:function(t){var s=null,i=[];if(ElyTools.each(this.sessions,function(e,n){!s&&e.length>0&&(s=n),!s&&t&&i.push(n)}),!s)return!1;var e=this.sessions[s].shift();if(!e)return!1;var n=e.split(",");return ElyTools.each(i,function(t){delete this.sessions[t]},this),{session:s,rule:n[0],time:n[1]}},getCurrentSession:function(){return this.currentSession||this._resolveCurrentSession()},getVisitorId:function(){return this.visitorId||this._resolveVisitorId()},addSession:function(t){if(!this.sessions[t]){if(!/^\d+$/.test(t))return[];this.sessions[t]=[]}return this.sessions[t]},shiftSession:function(){var t=!1;ElyTools.each(this.sessions,function(s,i){t||(t=i)}),t&&delete this.sessions[t]},getSavedSessions:function(){var t=ElyTools.keys(this.sessions);t.sort();var s=[];return ElyTools.each(t,function(t){var i=this.sessions[t];i.id=t,s.push(i)},this),s},getRulesPerSession:function(){var t=ElyTools.keys(this.rulesPerSession);t.sort();var s=this,i=[];return ElyTools.each(t,function(t){var e=s.rulesPerSession[t];e.id=t,i.push(e)}),i},_resolveCurrentSession:function(){var t="cSess",s=this.core.cookie(t),i=null;return i=s?s.toString():this.getNowTimestamp(),this.currentSession=i,this.sessions[i]||(this.sessions[i]=[],s||this.set(!1)),this.core.cookie(t,i,{expires:1/48,path:"/"}),i},getNowTimestamp:function(){var t=new Date;return Math.floor(t/1e3-this.getConfigOption("startPoint"))},getInitTimestamp:function(){var t=this.core.timeInit;return Math.floor(t/1e3-this.getConfigOption("startPoint"))},_getSizeLimit:function(){return Math.pow(2,53)},_calcStorageLenDiff:function(){return this.serialize().length-this._getSizeLimit()},getConfigOption:function(t){var s={cookie:"cookie",localStorage:"localStorage",userData:"localStorage",memory:"localStorage"}[this.getCodename()];return this.core.config.history[s][t]},getCodename:function(){},_resolveVisitorId:function(){var t=this.core.config.cookieId||"Ely_vID",s=this.core.cookie(t),i=null;return s?i=s.toString():(i=this.getId(),this.core.cookie(t,i,{expires:3650,path:"/"})),this.visitorId=i,i},getId:function(){"use strict";function t(){return Math.round(2147483647*Math.random())}function s(){var t={},s=window.screen,i=window.navigator;t.H=s?s.width+"x"+s.height:"-",t.G=s?s.colorDepth+"-bit":"-",t.language=(i&&(i.language||i.browserLanguage||"-")).toLowerCase(),t.javaEnabled=i&&i.javaEnabled()?1:0,t.characterSet=document.characterSet||document.charset||"-";try{var e=document.documentElement,n=document.body&&document.body.clientWidth&&document.body.clientHeight,r=[];throw e&&e.clientHeight&&e.clientWidth&&("CSS1Compat"===document.compatMode||!n)?r=[e.clientWidth,e.clientHeight]:n&&(r=[document.body.clientWidth,document.body.clientHeight]),t.clientSize=r.join("x"),"test"}catch(o){a.core.fireEvent("getId-getClientSizeFail",{error:o,lEnvVar:t},["exception"])}finally{return t}}function i(t,s){return void 0==t||"-"===t&&!s||""===t}function e(t){var s,e=1,n=0;if(!i(t))for(e=0,s=t.length-1;s>=0;s--)n=t.charCodeAt(s),e=(268435455&e<<6)+n+(n<<14),n=266338304&e,e=0!=n?e^n>>21:e;return e}function n(){if(!o){var t,i=s(),n=window.navigator,r=n.appName+n.appVersion+i.language+i.clientSize+i.characterSet+n.platform+n.userAgent+i.javaEnabled+i.H+i.G+(document.referrer||""),h=i.length;for(t=window.history.length;t>0;)r+=t--^h++;o=e(r)}return o}function r(){return t()^2147483647&n()}var o,h,a=this;try{return h=r(),this.core.fireEvent("idGenerationSuccess",{id:h},["globalLog"]),h}catch(l){this.core.fireEvent("IdGenerationFail",{error:l,id:h},["globalLog","exception"])}},getInstanceName:function(){return"ElyHistory"}});var ElyCookieHistory=ElyClass.create(ElyHistory,{codeName:"cookie",cookieSettings:{expires:600,path:"/",raw:!0},storageSizeLimit:1e3,_getVolume:function(t){return this.core.cookie(t,this.cookieSettings)},_setVolume:function(t,e){this.core.cookie(t,e,this.cookieSettings)},_getSizeLimit:function(){return Math.min(this.getConfigOption("storageSizeLimit")*this.getConfigOption("storageVolumeLimit"),this.needsRestriction()?1e3:4e3)},getCodename:function(){return this.codeName},isAvailable:function(){return"string"==typeof document.cookie&&navigator.cookieEnabled},needsRestriction:function(){var t=/MSIE (\d+\.\d+);/.test(navigator.userAgent);return t&&parseInt(t[1],10)<8},write:function(){var t,e=this.serialize(),i=this.getConfigOption("storageSizeLimit"),o=Math.min(this.getConfigOption("storageVolumeLimit"),Math.ceil(e.length/i)),n="ElyHistory";for(t=0;o>t;t++){var r=e.substr(t*i,i);this._setVolume(n+t,r)}return this.core.fireEvent("history."+this.getCodename()+"Write",{cookie:n,content:e},["globalLog"]),this},clearStorage:function(){var t="ElyHistory",e=0;do this._setVolume(t+e,null),++e;while(null!=ElyTools.getCookieByName(t+e));this.clear()}});var ElyLocalStorageHistory=ElyClass.create(ElyHistory,{codeName:"localStorage",_getSizeLimit:function(){return Math.min.call(Math,this.getConfigOption("storageSizeLimit")*this.getConfigOption("storageVolumeLimit"),2621440)},_getVolume:function(t){try{return window.localStorage.getItem(t)}catch(e){return null}},_setVolume:function(t,e){try{return window.localStorage.setItem(t,e)}catch(o){return null}},getCodename:function(){return this.codeName},clearItem:function(t){try{window.localStorage.removeItem(t)}catch(e){}},clearStorage:function(){try{window.localStorage.clear()}catch(t){}},isAvailable:function(){try{var t;do t=ElyTools.randomStr(8);while(null!=localStorage.getItem(t));return localStorage.setItem(t,t),localStorage.getItem(t)!=t?!1:(localStorage.removeItem(t),!0)}catch(e){return!1}}});var ElyMemoryHistory=ElyClass.create(ElyHistory,{codeName:"memory",_volumes:{},_getVolume:function(e){return this._volumes[e]||""},_setVolume:function(e,t){this._volumes[e]=t},_getSizeLimit:function(){return Math.pow(2,53)},getCodename:function(){return this.codeName},isAvailable:function(){return!0},clearStorage:function(){this._volumes={}}});
var OnSitePersonalizationAdapter=ElyClass.create(ElyAdapter,{operationQueue:null,enabled:!0,operationMapping:{},trackerInit:function(){this.operationQueue=[];var t=this.createOperationClass();this.operationMapping.chSource=this.createSrcOperationClass(t),this.operationMapping.chText=this.operationMapping.chHTML=this.createHtmlOperationClass(t),this.operationMapping.removeEl=this.createDelOperationClass(t)},createOperationClass:function(){return ElyClass.create({init:function(t,e){this.el=t,this.data=e,this.parent=t.parentNode},equals:function(t){return this instanceof t.constructor&&this.el===t.el&&this.data===t.data}})},createSrcOperationClass:function(t){return ElyClass.create(t,{init:function($super,t,e){$super(t,e),this.src=[t.getAttribute("src"),e]},on:function(){this.el.setAttribute("src",this.src[1])},off:function(){this.el.setAttribute("src",this.src[0])},equals:function(){return!1}})},createHtmlOperationClass:function(t){return ElyClass.create(t,{init:function($super,t,e){$super(t,e);var n=document.createElement("div");n.innerHTML=e,this.newNodes=[];var i,r=n.childNodes.length;for(i=0;r>i;i++)this.newNodes.push(n.childNodes[i])},on:function(){var t=this.el.nextSibling;this.parent.replaceChild(this.newNodes[0],this.el);var e,n=this.newNodes.length;for(e=1;n>e;e++)t?this.parent.insertBefore(this.newNodes[e],t):this.parent.appendChild(this.newNodes[e])},off:function(){this.parent.replaceChild(this.el,this.newNodes[0]);var t,e=this.newNodes.length;for(t=1;e>t;t++)this.parent.removeChild(this.newNodes[t])}})},createDelOperationClass:function(t){function e(t,e){if(e.indexOf)return e.indexOf(t);for(var n=e.length-1;n>=0;n--)if(t===e[n])return n;return-1}var n=this;return ElyClass.create(t,{init:function($super,t,n){$super(t,n),this.idx=e(this.el,this.parent.childNodes)},on:function(){this.tempDisplayStyle=this.el.style.display,n.core.setStyleProperty(this.el,"display","none",!0)},off:function(){n.core.setStyleProperty(this.el,"display",this.tempDisplayStyle)}})},trackerApply:function(t){var e,n,i=this.getMappings(t),r=i.length;for(n=0;r>n;n++)e=this.unpackMapping(i[n],t),e!==!1&&this.doOperation(e,t)},unpackMapping:function(t,e){t=t||{};var n,i=!1;try{"object"!=typeof t.code&&(n=JSONParser.prototype.parse(t.code),n.data&&(n.data=String(n.data).replace(/\/\*\\n\*\//g,"")),t.code=n),i=t}catch(r){this.mappingError(e,r)}return i},getActualData:function(t,e){function n(t){return e.getDataDimensionVal(t)}var i,r=t;return r&&(i=new Function("dd",String(r).replace(/\n/g,"")),r=i(n)),r},doOperation:function(t,e){if(t=t||{},!this.validateMapping(t,e))return!1;var n=t.code,i=this.operationMapping[n.operation];return"function"!=typeof i?(this.mappingError(e,"operation class for "+n.operation+" does not exist"),!1):this.checkData(n.data,e)?this.waitFor(n.selector,function(t){var r=new i(t[0],this.getActualData(n.data,e));this.addOperation(r)&&this.enabled&&r.on()},this):!1},addOperation:function(t){var e=this.operationQueue.length-1;for(e;e>=0;e--)if(t.equals(this.operationQueue[e]))return!1;return this.operationQueue.push(t),!0},disable:function(){if(this.enabled){this.enabled=!1;var t,e=this.operationQueue.length;for(t=e-1;t>=0;t--)this.operationQueue[t].off()}},enable:function(){if(!this.enabled){this.enabled=!0;var t,e=this.operationQueue.length;for(t=0;e>t;t++)this.operationQueue[t].on()}},waitFor:function(t,e,n){var i=this.core.jQ,r=this;return function a(){var o=i(t);return o.length?(e.call(n,o),!0):(r.__runChecker(a),!1)}()},validateMapping:function(t,e){var n=t.code,i=!1;return n?"object"!=typeof n&&this.mappingError(e,"Mapping code should be Object"):this.mappingError(e,"Mapping code is empty"),n.selector||this.mappingError(e,"Selector does not exist in mapping code"),n.operation?i=!0:this.mappingError(e,"Operation does not exist in mapping code"),i},mappingError:function(t,e){this.core.fireEvent("RuleMappingError",{instance:t,error:e},["exception"])},checkData:function(t,e){var n=typeof t;return"string"!==n&&"number"!==n&&"undefined"!==n?(this.mappingError(e,"Mapping data type can not be "+n),!1):!0},__checkerInterval:100,__runChecker:function(t){window.setTimeout(t,this.__checkerInterval)}});
var ely = (function(){var elyConfig = {"propertyModel":{"rule":[{"Codename":"codename","DisplayName":"Codename","Type":"string","IsRequired":true,"Tags":[]},{"Codename":"isPublic","DisplayName":"Allow Api access","Type":"bool","IsRequired":false,"Tags":[]},{"Codename":"independent","DisplayName":"Independent","Type":"bool","IsRequired":false,"Tags":[]},{"Codename":"saveToHistory","DisplayName":"Save to History","Type":"bool","IsRequired":false,"Tags":[]},{"Codename":"persistent","DisplayName":"Persistent","Type":"bool","IsRequired":false,"Tags":[]},{"Codename":"packagename","DisplayName":"Package","Type":"string","IsRequired":true,"Tags":[]},{"Codename":"conditions","DisplayName":"Conditions","Type":"array","IsRequired":false,"Tags":[]},{"Codename":"dataDimensions","DisplayName":"Values","Type":"array","IsRequired":false,"Tags":[]},{"Codename":"triggers","DisplayName":"Triggers","Type":"array","IsRequired":false,"Tags":[]},{"Codename":"id","DisplayName":"Id","IsRequired":true,"Type":"int"}],"closure":[{"Codename":"codename","DisplayName":"Codename","Type":"string","IsRequired":true,"Tags":[]},{"Codename":"packagename","DisplayName":"Package","Type":"string","IsRequired":true,"Tags":[]},{"Codename":"taxonomy","DisplayName":"Type","Type":"string","IsRequired":true,"Tags":[],"options":[{"TheValue":"trigger","DisplayName":null,"IsDefault":false},{"TheValue":"data_dimension","DisplayName":"value","IsDefault":false},{"TheValue":"condition","DisplayName":null,"IsDefault":false}]},{"Codename":"cost","DisplayName":"Cost","Type":"int","IsRequired":false,"Tags":[]},{"Codename":"exclusive","DisplayName":"Exclusive","Type":"bool","IsRequired":false,"Tags":[]},{"Codename":"lazy","DisplayName":"Lazy","Type":"bool","IsRequired":false,"Tags":[]},{"Codename":"sclosure","DisplayName":"Code","Type":"code","IsRequired":true,"Tags":[]},{"Codename":"argModel","DisplayName":"Arguments","Type":"array","IsRequired":true,"Tags":[]},{"Codename":"parentId","DisplayName":"Parent ID for copies","Type":"int","IsRequired":false,"Tags":[]},{"Codename":"id","DisplayName":"Id","IsRequired":true,"Type":"int"}],"tag":[{"Codename":"codename","DisplayName":"Codename","Type":"string","IsRequired":true,"Tags":[]},{"Codename":"packagename","DisplayName":"Package","Type":"string","IsRequired":true,"Tags":[]},{"Codename":"taxonomy","DisplayName":"Type","Type":"string","IsRequired":true,"Tags":[]},{"Codename":"code","DisplayName":"Code","Type":"text","IsRequired":true,"Tags":[]},{"Codename":"argModel","DisplayName":"Arguments","Type":"array","IsRequired":true,"Tags":[]},{"Codename":"library","DisplayName":"Library to load","Type":"string","Tags":[],"options":[{"TheValue":"","IsDefault":true}]},{"Codename":"library_when","DisplayName":"Load library","Type":"string","Tags":[],"options":[{"TheValue":"","IsDefault":true}]},{"Codename":"multiple_execution","DisplayName":"Allow multiple execution","Type":"bool","Tags":[],"options":[{"TheValue":"","IsDefault":true}]},{"Codename":"library_where","DisplayName":"Where to put script","Type":"string","Tags":[],"options":[{"TheValue":"head","IsDefault":false},{"TheValue":"body_before","IsDefault":false},{"TheValue":"body_after","IsDefault":true}]},{"Codename":"cookie","DisplayName":"Cookie Compliance","Type":"string","Tags":["cookie compliance"],"options":[{"TheValue":"none","IsDefault":true},{"TheValue":"opt-out","IsDefault":false},{"TheValue":"opt-in","IsDefault":false}]},{"Codename":"cookie_cat","DisplayName":"Cookie Compliance Category","Type":"string","Tags":["cookie compliance"]},{"Codename":"codeType","DisplayName":"Code type","Type":"string","Tags":[],"options":[{"TheValue":"script","IsDefault":true},{"TheValue":"html","IsDefault":false}]},{"Codename":"id","DisplayName":"Id","IsRequired":true,"Type":"int"}]},"history":{"sessionLimit":10,"localStorage":{"startPoint":1262300000,"volumeName":"ElyHistory","storageSizeLimit":12000,"storageVarLimit":25,"storageVolumeLimit":1},"cookie":{"startPoint":1262300000,"volumeName":"ElyHistory","storageSizeLimit":490,"storageVarLimit":25,"storageVolumeLimit":1,"domainPeriods":2}},"jquery":{"minVer":1.4,"maxVer":"1.9.1","cdn":"http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js","s":{"cdn":"https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"}},"track":"1","forceJquery":"","ignoreLocalStorage":"1","cookieCompliancePolicy":"none","cookieComplianceCategory":"analytics","cookieId":"","topDomain":"","charset":"ISO-8859-1","buildInfo":{"id":635,"version":8,"group":49},"env":"live","switchSrc":{"http":"http://s3.amazonaws.com/dc.customer.prod/dev/49/0f50e268.js","https":"https://s3.amazonaws.com/dc.customer.prod/dev/49/0f50e268.js"},"onSet":{"includes":[{"codename":"jquery","check":function (core) {
if(window.$){this._$ = window.$;}if(window.jQuery){this._jQuery = window.jQuery;} this.checkVersion = this.checkVersion || function checkVersion(core) {function version(ver) {return ElyArray.map((ver+'').split('.'), Number);}function v_lte(v1, v2) {var len = Math.min(v1.length, v2.length);for (var i = 0; i < len; i++) { if (v1[i] > v2[i]) return false; if (v1[i] < v2[i]) return true; }return v1.length <= v2.length;}var cur = version(window.jQuery.fn.jquery),min = version(core.config.jquery.minVer),max = version(core.config.jquery.maxVer);return (v_lte(min, cur) && v_lte(cur, max));}; return (!window.jQuery || core.config.force_jquery || !this.checkVersion(core));
},"complete":function (core) {
if(this._$)window.$=this._$; window.$sJQ=window.jQuery; if(this._jQuery)window.jQuery=this._jQuery; var _escapeable = /["\\\x00-\x1f\x7f-\x9f]/g; var _meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'}; window.$sJQ.extend(window.$sJQ, {toJSON: core.toJSON,secureEvalJSON: function(src) {if (false && typeof(JSON) == 'object' && JSON.parse) return JSON.parse(src);var filtered = src;filtered = filtered.replace(/\\["\\\/bfnrtu]/g, '@');filtered = filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']');filtered = filtered.replace(/(?:^|:|,)(?:\s*\[)+/g, '');if (/^[\],:{}\s]*$/.test(filtered)) return eval("(" + src + ")"); else return false;/* throw new SyntaxError("Error parsing JSON, source is not valid."); */},quoteString: function(string) {if (!string.match(_escapeable))return '"' + string + '"';return '"' + string.replace(_escapeable, function(a) {var c = _meta[a];if (typeof c === 'string')return c;c = a.charCodeAt().toString(16);while (c.length < 2) c = "0" + c;return'\\u00' + c;}) + '"';}});core.jQ = window.$sJQ;core._jqState = true;if(core.config.track) core._trackerReady();
},"url":"http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js","surl":"https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"},{"codename":"picker","check":function (core) {
return window.name == 'InEasyliticsHelper';
},"complete":function (core) {
if ('ElementPickerClient' in window)window.picker = new ElementPickerClient(ely, {});
},"url":"//s3.amazonaws.com/dc.customer.dev/picker/PickerSingle.js","surl":"https://s3.amazonaws.com/dc.customer.dev/picker/PickerSingle.js"},{"codename":"picker_live","check":function (core) {
return window.name == 'InEasyliticsHelper';
},"complete":function (core) {
if ('ElementPickerClient' in window)window.picker = new ElementPickerClient(ely, {});
},"url":"//media.swordfishdc.com/live/picker/PickerSingle.js","surl":"//a248.e.akamai.net/swordfishinc.download.akamai.com/145199/live/picker/PickerSingle.js"}],"adapters":[{"codename":"OnSitePersonalization"}],"adapterMappings":[{"adapter":"OnSitePersonalization","rule":140091,"code":"{\"data\":\"return '<div id=\\\"BannerContent2\\\">\\n<a href=\\\"#\\\" onclick=\\\"Banner.foljLank(1848, \\\\'\\/toppenlanet\\/ansokan.html?cmpi=ban-innometrics-toppenlanet\\\\'); return false\\\">\\n\\t<img src=\\\"https:\\/\\/www.nordnet.se\\/webdav\\/images\\/banners\\/se\\/Startsida%20liten%20+%20stor\\/FirstPage_banner_948x322_toppenl%C3%A5net_SE.JPG\\\" width=\\\"948\\\" height=\\\"322\\\" alt=\\\"L\\u00e5na pengar till marknadens b\\u00e4sta villkor\\\" title=\\\"\\\" style=\\\"display: inline;\\\">\\n<\\/a>\\n<\\/div>'\",\"operation\":\"chHTML\",\"selector\":\"#BannerContent2\"}","codename":"OnSitePersonalization 5068"}],"tags":[],"tagMappings":[],"closures":[{"codename":"In-page interaction","packagename":"Basic","taxonomy":"trigger","cost":2,"sclosure":function (rule, args, state) {
var $sJQ = rule.core.jQ;
var bRef = rule;
var handler = function (e) {
  bRef.createDataDimension('closureLiveEvent', e);
  bRef.createDataDimension(
    'closureLiveTarget',
    e.target || e.srcElement || e.originalTarget);
  bRef.trigger();
};
if (document.addEventListener) {
  return document.addEventListener(args.event, function (e) {
	var node = e.target;
    if (e.s_fe) { return; /* issue 1335, SC generate second event */ }
    if (/:first|:last/.test(args.selector)) {
      while (node) { 
      	if ($sJQ.inArray(node, $sJQ(args.selector)) >= 0) handler(e);
        node = node.parentNode;
      }
    } else {
      while (node) { 
      	if ($sJQ(node).is(args.selector)) handler(e);
        node = node.parentNode;
      }
    }
  }, true);
}
$sJQ(function () { /* should wait for page load before counting elements */
  var $els = $sJQ(args.selector);
  if ($els.length == 1) {
    $els.bind(args.event, handler);
  } else if ($sJQ.isFunction($sJQ.fn.on)) {
    $els.on(args.event, handler);
  } else {
    $els.live(args.event, handler);
  }
  });
},"argModel":[{"Codename":"selector","DisplayName":"jQuery selector","Type":"string","IsRequired":true,"options":[{"TheValue":"","IsDefault":true}],"DefaultValue":""},{"Codename":"event","DisplayName":"jQuery event","Type":"string","IsRequired":true,"options":[{"TheValue":"click","IsDefault":true},{"TheValue":"blur","IsDefault":false},{"TheValue":"change","IsDefault":false},{"TheValue":"focus","IsDefault":false},{"TheValue":"select","IsDefault":false},{"TheValue":"dblclick","IsDefault":false},{"TheValue":"keydown","IsDefault":false},{"TheValue":"keypress","IsDefault":false},{"TheValue":"keyup","IsDefault":false},{"TheValue":"mousemove","IsDefault":false},{"TheValue":"mouseout","IsDefault":false},{"TheValue":"mouseover","IsDefault":false},{"TheValue":"mousedown","IsDefault":false},{"TheValue":"mouseup","IsDefault":false},{"TheValue":"mouse wheel","IsDefault":false},{"TheValue":"reset","IsDefault":false},{"TheValue":"submit","IsDefault":false}],"DefaultValue":"click"}],"id":48},{"codename":"Page load","packagename":"Basic","taxonomy":"trigger","cost":2,"sclosure":function (rule, args, state) {
rule.core.addPageLoad(rule);
},"id":49},{"codename":"Number of occurrences","packagename":"PackageRoot","taxonomy":"condition","cost":2,"exclusive":true,"sclosure":function (rule, args, state) {
var arSs = [];
function convertInput(input){
    switch (input) {
        case 'Current session':
            return 0;
        case 'Last session':
            return 1;
        case '2 sessions ago':
            return 2;
        case '3 sessions ago':
            return 3;
        case '4 sessions ago':
            return 4;
        case '5 sessions ago':
            return 5;
        case '10 sessions ago':
            return 10;
        case '20 sessions ago':
            return 20;
        case 'Any session':
            return 1000
    }
}

var first = convertInput(args.first);
var last = convertInput(args.last);
ElyTools.each(rule.core.getHistory().rulesPerSession, function(v, sId){
    if (v[rule.id]) {
        arSs.push(v[rule.id])
    }
    else {
        arSs.push(0)
    }
});
var cnt = 0, rcnt = args.cnt ? args.cnt : 1;
for (var i = 0; i < arSs.length; i++) {
    var cPos = arSs.length - i - 1;
    if ((!args.hasOwnProperty('first') || first >= cPos) && (!args.hasOwnProperty('last') || last <= cPos)) {
        cnt += arSs[i]
    }
}
return rcnt <= cnt;
},"argModel":[{"Codename":"cnt","DisplayName":"Minimum occurrences","Type":"int","IsRequired":false,"options":[{"TheValue":"1","IsDefault":true}],"DefaultValue":"1"},{"Codename":"first","DisplayName":"Occurred first in","Type":"string","IsRequired":false,"options":[{"TheValue":"Current session","IsDefault":true},{"TheValue":"Last session","IsDefault":false},{"TheValue":"2 sessions ago","IsDefault":false},{"TheValue":"3 sessions ago","IsDefault":false},{"TheValue":"4 sessions ago","IsDefault":false},{"TheValue":"5 sessions ago","IsDefault":false},{"TheValue":"10 sessions ago","IsDefault":false},{"TheValue":"20 sessions ago","IsDefault":false},{"TheValue":"Any session","IsDefault":false}],"DefaultValue":"Current session"},{"Codename":"last","DisplayName":"Occured last in","Type":"string","IsRequired":false,"options":[{"TheValue":"Current session","IsDefault":true},{"TheValue":"Last session","IsDefault":false},{"TheValue":"2 sessions ago","IsDefault":false},{"TheValue":"3 sessions ago","IsDefault":false},{"TheValue":"4 sessions ago","IsDefault":false},{"TheValue":"5 sessions ago","IsDefault":false},{"TheValue":"10 sessions ago","IsDefault":false},{"TheValue":"20 sessions ago","IsDefault":false}],"DefaultValue":"Current session"}],"id":62},{"codename":"Value is smaller than","packagename":"Operators - positive","taxonomy":"condition","cost":2,"sclosure":function (rule, args, state) {
var v = rule.getDataDimensionVal(args.dd); return (v < args.to) || (!args.strictly && v == args.to);
},"argModel":[{"Codename":"dd","DisplayName":"Value","Type":"value","IsRequired":true,"options":[],"DefaultValue":""},{"Codename":"to","DisplayName":"Compare to","Type":"int","IsRequired":true,"options":[],"DefaultValue":""},{"Codename":"strictly","DisplayName":"Strictly","Type":"bool","IsRequired":true,"options":[{"TheValue":"false","IsDefault":false}],"DefaultValue":true}],"id":79},{"codename":"Value is equal to","packagename":"Operators - positive","taxonomy":"condition","cost":2,"sclosure":function (rule, args, state) {
return rule.getDataDimensionVal(args.dd) == args.to;
},"argModel":[{"Codename":"dd","DisplayName":"Value name","Type":"value","IsRequired":true,"options":[],"DefaultValue":""},{"Codename":"to","DisplayName":"Should be equal to","Type":"string","IsRequired":true,"options":[],"DefaultValue":""}],"id":126},{"codename":"Value contains","packagename":"Operators - positive","taxonomy":"condition","cost":2,"sclosure":function (rule, args, state) {
var ddValue = rule.getDataDimensionVal(args.dd);
var matchTo = args.part.toLowerCase();
ddValue = rule.core.toSimpleArray(ddValue).toString().toLowerCase();
return ddValue.indexOf(matchTo) != -1;
},"argModel":[{"Codename":"part","DisplayName":"String to search","Type":"string","IsRequired":true,"options":[{"TheValue":"","IsDefault":true}],"DefaultValue":""},{"Codename":"dd","DisplayName":"Source","Type":"value","IsRequired":true,"options":[{"TheValue":"","IsDefault":true}],"DefaultValue":""}],"id":127},{"codename":"Page URL","packagename":"Page","taxonomy":"data_dimension","cost":0,"sclosure":function (rule, args, state) {
return window.location.href;
},"id":4882},{"codename":"Sample rate","packagename":"Advanced","taxonomy":"data_dimension","cost":2,"sclosure":function (rule, args, state) {
return (Math.random()*100 < args.percentage);
},"argModel":[{"Codename":"percentage","DisplayName":"Sample rate in percent","Type":"int","IsRequired":true,"options":[{"TheValue":"","IsDefault":true}],"DefaultValue":""}],"id":5144},{"codename":"Score","packagename":"VisitorHistory","taxonomy":"data_dimension","cost":2,"sclosure":function (rule, args, state) {
var history=rule.core.getHistory();var storedScore=parseInt(history.getVar('score'+args.counter),10)||0;if(state==='populateDataDimensions'&&args.type!=='read'){if(args.type==='write'){storedScore+=parseInt(args.score,10)}else if(args.type==='reset'){storedScore=0}history.setVar('score'+args.counter,storedScore)}return storedScore;
},"argModel":[{"Codename":"counter","DisplayName":"Counter name","Type":"string","IsRequired":true,"options":[{"TheValue":"","IsDefault":true}],"DefaultValue":""},{"Codename":"score","DisplayName":"Score value","Type":"int","IsRequired":false,"options":[{"TheValue":"1","IsDefault":true}],"DefaultValue":"1"},{"Codename":"type","DisplayName":"Type","Type":"string","IsRequired":true,"options":[{"TheValue":"read","IsDefault":false},{"TheValue":"write","IsDefault":false},{"TheValue":"reset","IsDefault":false}],"DefaultValue":""}],"id":5326},{"codename":"Restrict per visitor, session or page load","packagename":"Other","taxonomy":"condition","cost":2,"sclosure":function (rule, args, state) {
var c = rule.core,
	id = rule.id,
	me = arguments.callee;
// condition is called before rule is actually triggered first time anyway
// hence we subscribe on rule triggers once in order to track them

// we get cookie and read both old (json) and new (array) formats
function get (cn) {
  var str = c.cookie(cn) || "";
  if (str.charAt(0) != '{') return str;
  var k, obj = c.fromJSON(str), a = [];
  for (k in obj) if (obj.hasOwnProperty(k)) a.push(k);
  return a.join(',');
}
// whether this id was used
function has (str, id) {
  return new RegExp("(^|,)" + id + "(,|$)").test(str);
}
// callback writing info about cookie 
function addId (cn, id) {
  var str = get(cn);
  if (has(str,id)) return;
  str = str + (str ? "," : "") + id;
  if (str.length > 1000) { str = str.substr(str.indexOf(',') + 1); } // do not allow overflow
  var cd = { secure: false, path: '/', raw: true };
  if (cn == 'elytil') { cd.expires = 3650; }
  c.cookie(cn, str, cd);
}
// flag that we already subscribed on event is written into the closure function itself
if (!me.rules) {
  me.rules = {session:{},visitor:{}};
  c.registerEvent('RuleTriggered', function (event) {
    var r = event.instance;
    r._triggered = true;
    if (me.rules.session[r.id]) addId('elytis', r.id);
    if (me.rules.visitor[r.id]) addId('elytil', r.id);
  });
}
if (rule._triggered) { return false; }
if (args.interval !== 'page load') {
  if (!c._canSaveCookie) { return false; } // TODO do not copy usage of this property
  var cn = ({session:'elytis',visitor:'elytil'})[args.interval];
  me.rules[args.interval][id] = true;
  return !has(get(cn), id);
}
return true;
},"argModel":[{"Codename":"interval","DisplayName":"Restrict per","Type":"string","IsRequired":true,"options":[{"TheValue":"session","IsDefault":false},{"TheValue":"visitor","IsDefault":false},{"TheValue":"page load","IsDefault":false}],"DefaultValue":""}],"id":5471},{"codename":"Value is true","packagename":"Operators - positive","taxonomy":"condition","cost":2,"sclosure":function (rule, args, state) {
return Boolean(rule.getDataDimensionVal(args.dd)); 
},"argModel":[{"Codename":"dd","DisplayName":"Value name","Type":"value","IsRequired":true,"options":[{"TheValue":"","IsDefault":true}],"DefaultValue":""}],"id":9149},{"codename":"Page path","packagename":"Page","taxonomy":"data_dimension","cost":0,"sclosure":function (rule, args, state) {
return window.location.pathname;
},"id":43568},{"codename":"Page init","packagename":"Basic","taxonomy":"trigger","cost":2,"sclosure":function (rule, args, state) {
rule.triggeredBy = 'init';
rule.trigger();
},"id":81772}],"rules":["(){\"codename\":\"Visited toppenlanet application\",\"saveToHistory\":true,\"packagename\":\"Segment\",\"conditions\":[{\"logic\":\"Operators - positive\\/Value contains\",\"args\":{\"part\":\"\\/toppenlanet\\/ansokan.html\",\"dd\":\"dd-5552\"}}],\"dataDimensions\":[{\"logic\":\"Page\\/Page URL\",\"args\":[],\"codename\":\"dd-5552\"}],\"triggers\":[{\"logic\":\"Basic\\/Page load\",\"args\":[]}],\"id\":140089}","(){\"codename\":\"Submit toppenlanet application\",\"saveToHistory\":true,\"packagename\":\"Segment\",\"conditions\":[{\"logic\":\"Operators - positive\\/Value contains\",\"args\":{\"part\":\"\\/toppenlanet\\/ansokan.html\",\"dd\":\"dd-2519\"}}],\"dataDimensions\":[{\"logic\":\"Page\\/Page path\",\"args\":[],\"codename\":\"dd-2519\"}],\"triggers\":[{\"logic\":\"Basic\\/In-page interaction\",\"args\":{\"selector\":\"#applicationForm > div.TLattest > div.loptext > div.outerWrapper > div.innerWrapper > span.btn > a:nth-child(1)\",\"event\":\"click\"}}],\"id\":140090}","((=140089{\"conditions\":[{\"logic\":\"PackageRoot/Number of occurrences\",\"args\":{\"cnt\":\"1\",\"first\":\"Any session\",\"last\":\"Current session\"}}]} && !=140090{\"conditions\":[{\"logic\":\"PackageRoot/Number of occurrences\",\"args\":{\"cnt\":\"1\",\"first\":\"Any session\",\"last\":\"Current session\"}}]})){\"codename\":\"Feed toppenlanet banner\",\"packagename\":\"Personalization\",\"conditions\":[{\"logic\":\"Operators - positive\\/Value is equal to\",\"args\":{\"dd\":\"dd-3471\",\"to\":\"\\/mux\\/web\\/nordnet\\/index.html\"}},{\"logic\":\"Operators - positive\\/Value is smaller than\",\"args\":{\"dd\":\"dd-6258\",\"to\":\"5\",\"strictly\":true}}],\"dataDimensions\":[{\"logic\":\"Page\\/Page path\",\"args\":[],\"codename\":\"dd-3471\"},{\"logic\":\"VisitorHistory\\/Score\",\"args\":{\"counter\":\"Impressions\",\"score\":\"1\",\"type\":\"write\"},\"codename\":\"dd-6146\"},{\"logic\":\"VisitorHistory\\/Score\",\"args\":{\"counter\":\"Impressions\",\"score\":\"1\",\"type\":\"read\"},\"codename\":\"dd-6258\"}],\"triggers\":[{\"logic\":\"Basic\\/Page init\",\"args\":[]}],\"id\":140091}","(){\"codename\":\"Test group 50%\",\"packagename\":\"Segment\",\"conditions\":[{\"logic\":\"Other\\/Restrict per visitor, session or page load\",\"args\":{\"interval\":\"visitor\"}},{\"logic\":\"Operators - positive\\/Value is true\",\"args\":{\"dd\":\"dd-2618\"}}],\"dataDimensions\":[{\"logic\":\"Advanced\\/Sample rate\",\"args\":{\"percentage\":\"50\"},\"codename\":\"dd-2618\"}],\"triggers\":[{\"logic\":\"Basic\\/Page load\",\"args\":[]}],\"description\":\"Selects every-other visitor to target them with A\\/B tests.\",\"id\":141177}"]}};var ely = new ElyCore(elyConfig);return ely;})();
function onPicker(e) {
if (e.data == 'picker') { ely.push({ method: 'includePicker', args: [] }); }
}
if (window.addEventListener) {
window.addEventListener('message', onPicker, false);
} else {
window.attachEvent('onmessage', onPicker);
}